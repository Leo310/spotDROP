<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>Startseite</title>
    <link rel="stylesheet" type="text/css" href="/resources/css/design.css">
    <script src="./categories.js"></script>
    <script src="./errorcodes.js"></script>
    <script src="./scripts.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
    <script>
        $(document).ready(() => {
            const spotcount = 0; // 0 equals all spots
            getSpots(spotcount);
        });

        function getSpots(count) {
            const urlParams = new URLSearchParams(window.location.search);
            const searchvalue = urlParams.get('search');
            document.getElementById("search").value = searchvalue;
            if (searchvalue) {
                fetch("/spotswithtitle", {
                        method: "post",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            "title": searchvalue,
                            "spotcount": count.toString()
                        })
                    })
                    .then(response => {
                        if (!response.ok)
                            throw new Error('Network response was not ok');
                        return response.json();
                    })
                    .then(content => {
                        if (content[0].status == errorcodes.success) {
                            createSpots(content, content.length - 1);
                        } else
                            console.log(content[0].status);

                    })
                    .catch(err => console.log(err))
            } else {
                fetch("/spots", {
                        method: "post",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            "spotcount": count.toString()
                        })
                    })
                    .then(response => {
                        if (!response.ok)
                            throw new Error('Network response was not ok');
                        return response.json();
                    })
                    .then(content => {
                        if (content[0].status == errorcodes.success) {
                            createSpots(content, content.length - 1);
                        } else
                            console.log(content[0].status);

                    })
                    .catch(err => console.log(err))
            }
        }

        function search(count = 0) {
            const searchvalue = document.getElementById("search").value;
            window.location = "/allspots?search=" + searchvalue;
        }

    </script>
    <!-- === navigationsleiste === -->
    <div class="fullscreen">
        <nav class="header-nav">

            <a href="/index"><img src="resources/img/logosketchwhite.png" alt=spotDROP.de></a>

            <ul>

                <li><a href="home">HOME</a></li>
                <li><a href="allspots">SPOTS</a></li>
                <li><a href="index">BOARDS</a></li>
                <li id="profile"><a href="profile">PROFILE</a></li>
                <li><a href="spotcreate">NEW SPOT</a></li>
                <li><button type="button" id="menubutton" onclick="logout();">SIGN OUT</button></li>

            </ul>

        </nav>

        <!--    <script>
                window.onscroll = scrollShowNav;
                function scrollShowNav() {
                    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    document.getElementsByTagName("nav")[0].style.top = "-50px";
                    } else {
                        document.getElementsByTagName("nav")[0].style.top = "0px";
                    }
                }
            </script> -->

        <!-- === willkommenstext === -->

        <div class="greeting">
            <p class="welcomeback" id="welcomeback">View or Search All Spots</p>
            <center>
                <p id="intro">In the following, you will see all Spots ever uploaded. Feel free to comb through them or
                    search the right Spot for your occasion. </p>
            </center>
        </div>

        <div class="search">

            <!-- <img id="searchicon" src="resources/img/loupe.png" alt="Search"> -->

            <input type="text" id="search" placeholder="Search Spot" name="Search">
            <button class="filtercatbutton" onclick="showCatDiv()" name="filtercat">by Category</button>
            <img src="resources/img/icons/loupe.png" class="searchicon" onclick="search()">

        </div>

        <img class="arrowdown" src="resources/img/arrow-down.png">


    </div>

    <div class="overview">

        <h1 id="TopSpots">All Spots ever uploaded</h1>
        <p class="subtext">Alternatively, view the Top Spots of The Week Â»</p>
        <div id="spotsview" class="flex-container">


        </div>


    </div>


</body>

</html>