<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>Startseite</title>
    <link rel="stylesheet" type="text/css" href="/resources/css/design.css">
    <script src="./scripts.js"></script>
    <script src="./errorcodes.js"></script>
    <script src="./categories.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
    <script>
        const topspotcount = 8;
        
        getTopSpots(topspotcount);

        function getTopSpots(count) {
            fetch("/topspots", {
                    method: "post",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "spotcount": count
                    })
                })
                .then(response => {
                    if (!response.ok)
                        throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(content => {
                    if (content[0].status == errorcodes.success) {
                        createTopSpots(content, count);
                    } else
                        console.log(content.status);

                })
                .catch(err => console.log(err))
        }

        function createTopSpots(spots, count) {
            document.getElementById("TopSpots").innerHTML = "Top " + count + " Spots of the Week";
            $(document).ready(() => { 
                for(let i = 1; i <= count; i++) //index 0 is status code
                {
                    $("#topspotss").append(
                        $('<div>', {"class": "spot-preview"}).append(
                            $('<img>', {"class":"previewimg", "src":"resources/img/spotdefault.png"}),
                            $('<div>', {"class":"databar"}).append(
                                $('<h2>', {"text": spots[i].title}),
                                $('<h3>', {"text": spots[i].street + ", " + spots[i].zip + " " + spots[i].city}),
                                $('<p>' ,{"class":"prating", "text":"4.5"})
                            ),
                            $('<div>', {"class":"iconbar"}).append(
                                $('<img>', {"class":"actionbarmini1", "src":"resources/img/icons/view.png"}),
                                $('<p>', {"id":"viewcount", "text":spots[i].views}),
                                $('<img>', {"class":"actionbarmini2", "src":"resources/img/icons/fave.png"}),
                                $('<img>', {"class":"actionbarmini3", "src":"resources/img/icons/save.png"})
                            )    
                        )
                    );
                }
            })
        }
        
        function getUsername() {
            fetch("/profile", {
                    method: "post",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "getloginedusername": "Get username"
                    })
                })
                .then(response => {
                    if (!response.ok)
                        throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(content => {
                    if (content.status == "Success") {
                        console.log("Succesfully fetched Username");
                        document.querySelector("#welcomeback").innerHTML = "Welcome back, " + content.username +
                        ".";
                    } else
                        console.log(content.status);

                })
                .catch(err => console.log(err))
        }

        function showCatDiv() {
            var x = document.getElementById("filtercat");
            if (x.style.display === "block") {
                x.style.display = "none";
            } else {
                x.style.display = "block";
            }
        }

        getUsername();
    </script>
    <!-- === navigationsleiste === -->
    <div class="fullscreen">
        <nav class="header-nav">

            <a href="/index"><img src="resources/img/logosketchwhite.png" alt=spotDROP.de></a>

            <ul>

                <li><a href="home">HOME</a></li>
                <li><a href="allspots">SPOTS</a></li>
                <li><a href="index">BOARDS</a></li>
                <li id="profile"><a href="profile">PROFILE</a></li>
                <li><a href="spotcreate">NEW SPOT</a></li>
                <li><button type="button" id="menubutton" onclick="logout();">SIGN OUT</button></li>

            </ul>

        </nav>

        <!--    <script>
                window.onscroll = scrollShowNav;
                function scrollShowNav() {
                    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    document.getElementsByTagName("nav")[0].style.top = "-50px";
                    } else {
                        document.getElementsByTagName("nav")[0].style.top = "0px";
                    }
                }
            </script> -->

        <!-- === willkommenstext === -->

        <div class="centerdiv">
            <div class="greeting">
                <p class="welcomeback" id="welcomeback"></p>
                <center>
                    <p id="intro">Great to see you again.
                        As usually, start searching for Spots right away or share
                        your favorite Spots with everyone else.</p>
                </center>
            </div>




            <img class="arrowdown" src="resources/img/arrow-down.png">

        </div>
    </div>

    <div class="overview">

        <h1 id="TopSpots"></h1>
        <p class="subtext">Alternatively, view all Spots or search through them Â»</p>
        <div id="topspotss" class="flex-container">
            


        </div>


    </div>


    </div>


</body>

</html>